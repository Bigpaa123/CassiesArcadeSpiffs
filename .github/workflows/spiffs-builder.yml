name: build-spiffs

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build-spiffs:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Create data folder and move files
      run: |
        mkdir -p data
        mv *.html *.css *.js data/ 2>/dev/null || true

    - name: Download mkspiffs binary
      run: |
        mkdir tools
        cd tools
        wget https://github.com/igrr/mkspiffs/releases/download/0.2.3/mkspiffs-0.2.3-linux64.tar.gz
        tar -xzf mkspiffs-0.2.3-linux64.tar.gz
        chmod +x mkspiffs
        sudo mv mkspiffs /usr/local/bin/

    - name: Build SPIFFS image
      run: |
        mkspiffs -c data -b 4096 -p 256 -s 0x100000 spiffs.bin

    - name: Upload SPIFFS binary
      uses: actions/upload-artifact@v4
      with:
        name: spiffs
        path: spiffs.bin
